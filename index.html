<!doctype html>
<html>
<head>
    <meta charset="UTF-8"/>
    <style>
        .cell {
            display: inline-block;
            border: 1px solid black;
            padding: 5px;
            margin-right: 5px;
            width: 30px;
            text-align: center;
        }

        .heading {
            background-color: #808080;
        }

        .addend {
            color: red;
        }

        #question {
            width: 500px;
            margin: 5px;
            padding: 1px;
            background-color: #e0e0e0;
        }

        #feedback {

        }

        .history {
            float: right;
            border: 1px solid black;
            width: 300px;
            height: 400px;
            padding: 10px;
            margin: 10px;
            overflow: scroll;
        }

        #invalidAnswers {
            border: 1px solid orange;
        }

    </style>
    <script>
        var data = []
        var validAnswers = 0;
        var allAnswers = 0;
        var difficulty = 1;

        for (var i = 0; i < 10; i++) {
            data[i] = []
            for (var j = 0; j < 10; j++) {
                data[i][j] = { valid: 0, invalid: 0};
            }
        }

        function run() {
            renderTable();
            updateRadioButtons();
            askQuestion();
        }

        function toHex(number) {
            var result = number.toString(16);
            if (result.length < 2) {
                result = "0" + result;
            }
            return result;
        }

        function makeBackgroundColor(value) {
            value = Math.min(Math.max(0,value), 1) * 510;

            var redValue;
            var greenValue;
            if (value < 255) {
                redValue = 255;
                greenValue = Math.sqrt(value) * 16;
                greenValue = Math.round(greenValue);
            } else {
                greenValue = 255;
                value = value - 255;
                redValue = 255 - (value * value / 255)
                redValue = Math.round(redValue);
            }

            return "#" + toHex(redValue) + toHex(greenValue) + "00";
        }

        function makeForegroundColor(value) {
            if (value > 10) {
                return "#000000";
            }

            var relative = 255- parseInt(255*parseFloat(value / 10));
            return "#"+toHex(relative)+toHex(relative)+toHex(relative);
        }

        function renderTable() {
            var table = "<p>";
            for (var idx = 0; idx < 11; idx++) {
                table += "<div class='cell heading'>" + idx +"</div>"
            }
            table += "</p>"
            for (var y = 0; y < 10; y++) {
                table += "<p><div class='cell heading'>" + (y+1) +"</div>"
                for (var x = 0; x < 10; x++) {
                    var valid_answers = data[x][y].valid
                    var all_answers = data[x][y].valid + data[x][y].invalid
                    var backgroundColor = "#ffffff";
                    var foregroundColor = "#ffffff";

                    if (all_answers > 0) {
                        var ratio = parseFloat(valid_answers) / parseFloat(all_answers);
                        backgroundColor = makeBackgroundColor(ratio);
                        foregroundColor = makeForegroundColor(all_answers);
                    }

                    var style="background-color: "+backgroundColor + "; color: " + foregroundColor;
                    table += "<div class='cell' style='"+style+"'>"+data[x][y].valid + "/" + data[x][y].invalid + "</div>"       
                }
                table += "<p>"
            }
            document.getElementById("table").innerHTML = table

            document.getElementById("summary").innerHTML = "Liczba zadanych pytań: " + allAnswers + ". Liczba prawidłowych odpowiedzi: " + validAnswers + ".";        
        }

        var numberPerLevel = [ 
            [1, 10], 
            [1, 2, 10], 
            [1, 2, 3, 5, 10], 
            [1, 2, 3, 4, 5, 10], 
            [1, 2, 3, 4, 5, 8, 9, 10],
            [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
            ];

        function pickANumber() {
            return number;
        }

        function askQuestion() {
            var availableNumbers = numberPerLevel[difficulty-1];
            var x = availableNumbers[Math.floor(Math.random() * (availableNumbers.length))];
            var y = Math.floor(Math.random() * 10 + 1);

            if (Math.random() > 0.5) {
                var z = x;
                x = y;
                y = z;
            }

            document.getElementById("x").innerHTML = x
            document.getElementById("y").innerHTML = y

            document.getElementById("answer").focus();
        }

        function submitAnswer() {
            var answer = parseInt(document.getElementById("answer").value);
            var x = parseInt(document.getElementById("x").innerHTML);
            var y = parseInt(document.getElementById("y").innerHTML);

            if (x * y == answer) {
                data[x-1][y-1].valid += 1;
                document.getElementById("feedback").innerHTML = "Dobrze! " + x + " &times; " + y + " = "+ (x*y) + ".";
                document.getElementById("answer").value = "";
                validAnswers += 1;
                allAnswers += 1;

                answers = document.getElementById("validAnswers");
                answers.innerHTML += x + " &times; " + y + " = "+ (x*y) + "<br/>";;
                answers.scrollTop = answers.scrollHeight;
            } else {
                data[x-1][y-1].invalid += 1;
                document.getElementById("feedback").innerHTML = "Niestety, źle. Powinno być: " + x + " &times; " + y + " = "+ (x*y) + ", a nie " + answer + ".";
                document.getElementById("answer").value = "";
                allAnswers += 1;

                answers = document.getElementById("invalidAnswers");
                answers.innerHTML += x + " &times; " + y + " = "+ answer + "<br/>";;
                answers.scrollTop = answers.scrollHeight;
            }
            renderTable();
            askQuestion();
        }

        function setLevel(level) {
            difficulty = level;
            updateRadioButtons();
        }

        function updateRadioButtons() {
            for (var i = 1; i <= 6; i++) {
                var radioButton = document.getElementById("level" + i);
                if (i == difficulty) {
                    radioButton.checked = true;
                } else {
                    radioButton.checked = false;
                }
            }
        }
    </script>
</head>
<body onload="run();">
    <div id="invalidAnswers" class="history">Złe odpowiedzi:<br/></div>
    <div id="validAnswers" class="history">Dobre odpowiedzi:<br/></div>
    <div id="table"></div>
    <div id="settings">
        <p>Poziom trudności:
        <input id="level1" type="radio" value="1" onclick="setLevel(1);">Bardzo łatwy</input>
        <input id="level2" type="radio" value="2" onclick="setLevel(2);">Łatwy</input>
        <input id="level3" type="radio" value="3" onclick="setLevel(3);">Średni</input>
        <input id="level4" type="radio" value="4" onclick="setLevel(4);">Trudny</input>
        <input id="level5" type="radio" value="5" onclick="setLevel(5);">Bardzo trudny</input>
        <input id="level6" type="radio" value="6" onclick="setLevel(6);">Cała tabliczka mnożenia</input>
        </p>
    </div>
    <div id="summary"></div>
    <div id="question">
        <p><span id="feedback"></span></p>
        <p>Ile to jest <span class="addend" id="x"></span> &times; <span class="addend" id="y"></span>?</p>
        <input id="answer" type="text" onkeydown="if (event.keyCode==13) {submitAnswer();}"></input>
        <a href="#" onclick="submitAnswer();">OK</a>
    </div>
    <div id="debug"></div>
</body>
</html>